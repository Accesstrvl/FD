<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log in</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
  </head>

  <body class="font-['Inter']">
    <div class="flex flex-row h-[99vh] w-full">
      <div
        class="relative w-1/2 mt-[50px] px-[80px] h-[80vh] flex flex-col gap-[50px] text-center"
      >
        <a href="index.html" class="absolute top-[2px] left-[25px]">
          <img
            class="w-[30px] h-[30px] cursor-pointer hover:opacity-70 transition-opacity"
            src="https://res.cloudinary.com/dwivnxoyv/image/upload/v1768139023/mingcute_left-fill_fgy7tw.png"
            alt="Back"
          />
        </a>

        <div
          class="pt-[20px] pb-[10px] flex flex-col gap-[15px] w-[95%] mx-auto text-left"
        >
          <p class="text-[30px] font-medium leading-none text-center">
            Welcome Back!
          </p>
          <p class="text-[20px] font-normal text-center">
            Login to continue planning trips that works for you
          </p>
        </div>

        <form id="loginForm" class="flex flex-col gap-[22px]">
  <input
    id="email" 
    name="email"
    class="h-[45px] border-[3px] border-[#e5e7eb] pl-[20px] placeholder:text-black/50 placeholder:font-normal placeholder:text-[14px] w-full focus:outline-none focus:border-[#1e40af] rounded-lg"
    placeholder="Full name/Email"
    type="email"
    required
  />

  <div class="relative">
    <input 
      id="password" 
      class="h-[45px] border-[3px] border-[#e5e7eb] pl-[20px] pr-12 w-full focus:outline-none focus:border-[#1e40af] rounded-lg placeholder:text-black/50 placeholder:font-normal placeholder:text-[14px]" 
      placeholder="Enter your password" 
      type="password" 
      required 
    />
    <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-[#1e40af] cursor-pointer">
       <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 hidden">
         <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
         <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
       </svg>
       <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
         <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
       </svg>
    </button>
  </div>

  <div class="text-right mb-[20px]">
    <a href="#" class="text-[#0ea5a4] underline hover:text-teal-700">Forgot Password?</a>
  </div>

  <div id="error-message" class="text-red-600 text-sm font-bold"></div>

  <button
    id="loginBtn"
    class="h-[50px] rounded-[10px] bg-[#1e40af] text-white text-[20px] w-full cursor-pointer hover:opacity-90 flex items-center justify-center gap-3 disabled:opacity-70 disabled:cursor-not-allowed transition"
    type="submit"
  >
    <svg id="btnSpinner" class="animate-spin h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    <span id="btnText">Login</span>
  </button>
</form>
        <div class="text-center pt-[10px]">
          <p>
            Don't have an account?
            <a
              href="sign-up.html"
              class="text-[#0ea5a4] underline hover:text-teal-700"
              >Sign up</a
            >
          </p>
        </div>
      </div>

      <div class="w-1/2 h-full">
        <img
          class="w-full h-full object-cover rounded-tl-[10px]"
          src="https://res.cloudinary.com/dwivnxoyv/image/upload/v1768083733/70697cc28aad698a03e2dd0aa99c2aec85c1a27d_uood7z.jpg"
          alt="Background"
        />
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script type="module">
      import { AuthRepositoryImpl } from "../asset/js/data/repositories/AuthRepositoryImpl.js";

      const authRepo = new AuthRepositoryImpl();
      const loginForm = document.getElementById("loginForm");
      const errorBox = document.getElementById("error-message");
      // --- PASSWORD TOGGLE LOGIC ---
      const toggleBtn = document.getElementById("togglePassword");
      const passwordInput = document.getElementById("password");
      const eyeOpen = document.getElementById("eyeOpen");
      const eyeClosed = document.getElementById("eyeClosed");

      if (toggleBtn && passwordInput) {
        toggleBtn.addEventListener("click", () => {
          // 1. Check current type
          const isPassword = passwordInput.type === "password";

          // 2. Toggle Type
          passwordInput.type = isPassword ? "text" : "password";

          // 3. Toggle Icons
          if (isPassword) {
            // Show "Open Eye" (Visible)
            eyeOpen.classList.remove("hidden");
            eyeClosed.classList.add("hidden");
          } else {
            // Show "Closed Eye" (Hidden)
            eyeOpen.classList.add("hidden");
            eyeClosed.classList.remove("hidden");
          }
        });
      }
      if (loginForm) {
        loginForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          if (errorBox) errorBox.innerText = "Connecting to server...";

          try {
            console.log("Attempting login with:", email);
            const user = await authRepo.login(email, password);

            // ✅ FIX: Save ALL user info to LocalStorage
            if (user.token) localStorage.setItem("token", user.token);

            // Save Name
            if (user.name) {
              localStorage.setItem("accessTravelUser", user.name);
              localStorage.setItem("userName", user.name);
            }

            // ✅ Save Email (So Personal Details page can find it instantly)
            if (user.email) {
              localStorage.setItem("userEmail", user.email);
            }

            // Success!
            alert("Login Successful! Welcome " + (user.name || "Traveller"));
            window.location.href = "home-sign-in.html"; // Or 'acessablity.html'
          } catch (error) {
            // (Keep your existing error handling here)
            console.error("Login Failed:", error);
            const serverMessage =
              error.response?.data?.message || "Invalid credentials";
            if (errorBox) errorBox.innerText = serverMessage;
            alert("Login failed: " + serverMessage);
          }
        });
      }
    </script>
  </body>
</html>
